<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hockey Stat Sheet</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Hockey Stats">

<style>
body { font-family: system-ui; margin: 0; }
nav { display: flex; background: #111; color: white; }
nav button { flex: 1; padding: 12px; border: none; background: none; color: white; }
nav button.active { background: #333; }
section { display: none; padding: 12px; }
section.active { display: block; }

input, select, button { margin: 4px 0; padding: 6px; }

.log { border-top: 1px solid #ccc; margin-top: 10px; padding-top: 10px; }
.scoreline { font-size: 18px; margin: 8px 0; }

/* Box score polish */
#boxScore {
  background: #fafafa;
  border: 1px solid #ccc;
  padding: 12px;
  font-size: 14px;
  line-height: 1.4;
}
#boxScore h4 {
  margin: 8px 0 4px;
  border-bottom: 1px solid #ddd;
  padding-bottom: 2px;
}
#boxScore .final {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 6px;
}
#boxScore .period {
  margin-top: 8px;
}
#boxScore .event {
  margin-left: 10px;
}
</style>
</head>

<body>

<nav>
  <button data-tab="seasons" class="active">Seasons</button>
  <button data-tab="teams">Teams</button>
  <button data-tab="newgame">New Game</button>
  <button data-tab="game">Game</button>
  <button data-tab="boxscore">Box Score</button>
</nav>

<section id="seasons" class="active">
  <h3>Seasons</h3>

  <button id="backupBtn">Backup Data</button>
  <button id="restoreBtn">Restore Data</button>
  <input id="restoreInput" type="file" accept=".json" style="display:none">

  <br><br>

  <input id="seasonName" placeholder="Season name">
  <button id="addSeason">Add Season</button>
  <div id="seasonList"></div>
</section>

<section id="teams">
  <h3>Teams</h3>
  <select id="teamSeason"></select><br>
  <input id="teamName" placeholder="Team name">
  <input id="teamAbbr" placeholder="Abbr">
  <button id="addTeam">Add Team</button>
  <div id="teamList"></div>

  <h4>Roster</h4>
  <select id="rosterTeam"></select><br>
  <input id="playerNum" placeholder="#" style="width:60px">
  <input id="playerName" placeholder="Player name">
  <select id="playerPos">
    <option value="F">Forward</option>
    <option value="D">Defense</option>
    <option value="G">Goalie</option>
  </select>
  <button id="addPlayer">Add Player</button>
  <div id="rosterList"></div>
</section>

<section id="newgame">
  <h3>New Game</h3>
  <select id="ngSeason"></select><br>
  <select id="ngAway"></select>
  <select id="ngAwayG"></select><br>
  <select id="ngHome"></select>
  <select id="ngHomeG"></select><br>
  <button id="startGame">Start Game</button>
</section>

<section id="game">
  <h3 id="gameStatus"></h3>
  <div style="font-size:12px;color:#666;margin-bottom:6px;">
    <span id="appVersion"></span>
  </div>

  <div class="scoreline">
    Score: <span id="scoreAway">0</span> – <span id="scoreHome">0</span><br>
    Shots: <span id="shotsAway">0</span> – <span id="shotsHome">0</span>
  </div>

  <h2 id="clock">20:00</h2>
  <button id="clockToggle">Start / Stop</button>
  <button id="clockPlus">+1 min</button>
  <button id="advancePeriod">Advance Period</button>

  <div class="log" id="eventLog"></div>
</section>

<section id="boxscore">
  <h3>Box Score</h3>
  <div id="boxScore"></div>
</section>

<script>
const APP_VERSION = "v1.0.0 – Box Score Polished";

const $ = id => document.getElementById(id);

const state = { game:null };

/* tabs */
document.querySelectorAll("nav button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll("nav button").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
    b.classList.add("active");
    $(b.dataset.tab).classList.add("active");
    if(b.dataset.tab==="boxscore") renderBoxScore();
  };
});

/* polished box score */
function renderBoxScore(){
  if(!state.game){
    boxScore.innerHTML = "No game data.";
    return;
  }

  const away = state.game.away;
  const home = state.game.home;

  let html = `
    <div class="final">
      ${away} ${state.game.score.away} — ${home} ${state.game.score.home}
    </div>
    <em>Final</em>
  `;

  const lines = eventLog.innerHTML.split("<br>").filter(Boolean);
  const periods = {};

  lines.forEach(l=>{
    const m = l.match(/P(\d+)/);
    if(!m) return;
    if(!periods[m[1]]) periods[m[1]] = [];
    periods[m[1]].push(l);
  });

  html += `<h4>Scoring Summary</h4>`;

  Object.keys(periods).forEach(p=>{
    html += `<div class="period"><strong>Period ${p}</strong></div>`;
    periods[p].forEach(e=>{
      html += `<div class="event">• ${e}</div>`;
    });
  });

  boxScore.innerHTML = html;
}

appVersion.textContent = APP_VERSION;
</script>

</body>
</html>