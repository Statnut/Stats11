<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hockey Stat Sheet</title>

<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body { font-family: system-ui; margin: 0; }
nav { display: flex; background: #111; color: white; }
nav button { flex: 1; padding: 12px; border: none; background: none; color: white; }
nav button.active { background: #333; }
section { display: none; padding: 12px; }
section.active { display: block; }
input, select, button, textarea { margin: 4px 0; padding: 6px; width: 100%; }
.list-item { display:flex; justify-content:space-between; align-items:center; }
.scoreline { font-size: 18px; margin: 8px 0; }
.log { border-top: 1px solid #ccc; margin-top: 10px; padding-top: 10px; }
textarea { min-height: 80px; }
.box { border:1px solid #ccc; padding:8px; margin:8px 0; }
</style>
</head>

<body>

<nav>
  <button data-tab="seasons" class="active">Seasons</button>
  <button data-tab="teams">Teams</button>
  <button data-tab="newgame">New Game</button>
  <button data-tab="game">Game</button>
  <button data-tab="boxscore">Box Score</button>
</nav>

<section id="seasons" class="active">
  <h3>Seasons</h3>
  <input id="seasonName" placeholder="Season name">
  <button id="addSeason">Add Season</button>
  <div id="seasonList"></div>
</section>

<section id="teams">
  <h3>Teams</h3>
  <select id="teamSeason"></select>
  <input id="teamName" placeholder="Team name">
  <input id="teamAbbr" placeholder="Abbr">
  <button id="addTeam">Add Team</button>
  <div id="teamList"></div>

  <h4>Roster</h4>
  <select id="rosterTeam"></select>
  <input id="playerNum" placeholder="#">
  <input id="playerName" placeholder="Player name">
  <select id="playerPos">
    <option value="F">Forward</option>
    <option value="D">Defense</option>
    <option value="G">Goalie</option>
  </select>
  <button id="addPlayer">Add Player</button>
  <div id="rosterList"></div>
</section>

<section id="newgame">
  <h3>New Game</h3>
  <select id="ngSeason"></select>
  <select id="ngAway"><option value="">Away Team</option></select>
  <select id="ngAwayG"><option value="">Away Goalie</option></select>
  <select id="ngHome"><option value="">Home Team</option></select>
  <select id="ngHomeG"><option value="">Home Goalie</option></select>
  <button id="startGame">Start Game</button>
</section>

<section id="game">
  <h3 id="gameStatus"></h3>

  <div class="scoreline">
    Score: <span id="scoreAway">0</span> – <span id="scoreHome">0</span><br>
    Shots: <span id="shotsAway">0</span> – <span id="shotsHome">0</span><br>
    Faceoffs: <span id="foAway">0</span> – <span id="foHome">0</span>
  </div>

  <h2 id="clock">20:00</h2>
  <button id="clockToggle">Start / Stop</button>
  <button id="advancePeriod">Advance Period</button>
  <button id="endGame">End Game</button>

  <h4>Add Goal</h4>
  <select id="goalTeam"></select>
  <select id="goalScorer"></select>
  <select id="goalA1"></select>
  <select id="goalA2"></select>
  <select id="goalType">
    <option>EV</option><option>PP</option><option>SH</option><option>EN</option><option>PS</option>
  </select>
  <button id="recordGoal">Record Goal</button>

  <h4>Add Shot</h4>
  <select id="shotTeam"></select>
  <select id="shotPlayer"></select>
  <button id="recordShot">Record Shot</button>

  <h4>Add Faceoff Win</h4>
  <select id="foTeam"></select>
  <button id="recordFO">Record Faceoff</button>

  <h4>Add Penalty</h4>
  <select id="penTeam"></select>
  <select id="penPlayer"></select>
  <select id="penType">
    <option>Tripping</option><option>Hooking</option><option>Slashing</option>
    <option>Interference</option><option>Roughing</option>
    <option>Holding</option><option>High-sticking</option>
    <option>Boarding</option><option>Charging</option>
    <option>Cross-checking</option><option>Misconduct</option>
  </select>
  <input id="penMinutes" type="number" value="2">
  <button id="recordPenalty">Record Penalty</button>

  <h4>Game Notes</h4>
  <textarea id="gameNotes"></textarea>

  <div class="log" id="eventLog"></div>
</section>

<section id="boxscore">
  <h3>Box Score</h3>
  <div id="boxScore"></div>
</section>

<script>
const $=id=>document.getElementById(id);
let state=JSON.parse(localStorage.getItem("hockeyState"))||{
  seasons:[],teams:{},rosters:{},
  game:null,
  clock:{seconds:1200,running:false},
};

function save(){localStorage.setItem("hockeyState",JSON.stringify(state));}

document.querySelectorAll("nav button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll("nav button").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
    b.classList.add("active");$(b.dataset.tab).classList.add("active");
    if(b.dataset.tab==="boxscore")renderBoxScore();
  };
});

addSeason.onclick=()=>{
  if(!seasonName.value)return;
  if(!state.seasons.includes(seasonName.value)){
    state.seasons.push(seasonName.value);state.teams[seasonName.value]=[];
  }
  seasonName.value="";renderSeasons();save();
};

function renderSeasons(){
  seasonList.innerHTML="";
  state.seasons.forEach(s=>{
    const d=document.createElement("div");d.className="list-item";
    d.innerHTML=`<span>${s}</span>`;
    const del=document.createElement("button");
    del.textContent="Delete";del.onclick=()=>{
      state.seasons=state.seasons.filter(x=>x!==s);
      delete state.teams[s];renderSeasons();renderTeams();save();
    };
    d.appendChild(del);seasonList.appendChild(d);
  });
  teamSeason.innerHTML=ngSeason.innerHTML=
    `<option value="">Select Season</option>`+
    state.seasons.map(s=>`<option>${s}</option>`).join("");
}

addTeam.onclick=()=>{
  const s=teamSeason.value;
  if(!s||!teamName.value)return;
  state.teams[s].push({name:teamName.value,abbr:teamAbbr.value});
  state.rosters[teamName.value]=[];
  teamName.value=teamAbbr.value="";
  renderTeams();save();
};

function renderTeams(){
  teamList.innerHTML="";
  rosterTeam.innerHTML="";
  ngHome.innerHTML='<option value="">Home Team</option>';
  ngAway.innerHTML='<option value="">Away Team</option>';
  (state.teams[teamSeason.value]||[]).forEach(t=>{
    const d=document.createElement("div");d.className="list-item";
    d.innerHTML=`<span>${t.name} (${t.abbr})</span>`;
    const del=document.createElement("button");
    del.textContent="Delete";del.onclick=()=>{
      state.teams[teamSeason.value]=state.teams[teamSeason.value].filter(x=>x!==t);
      delete state.rosters[t.name];renderTeams();save();
    };
    d.appendChild(del);teamList.appendChild(d);
    rosterTeam.innerHTML+=`<option>${t.name}</option>`;
    ngHome.innerHTML+=`<option>${t.name}</option>`;
    ngAway.innerHTML+=`<option>${t.name}</option>`;
  });
}

addPlayer.onclick=()=>{
  const t=rosterTeam.value;
  if(!t||!playerName.value)return;
  state.rosters[t].push({number:playerNum.value,name:playerName.value,position:playerPos.value});
  playerNum.value=playerName.value="";
  renderRoster();save();
};

function renderRoster(){
  rosterList.innerHTML="";
  (state.rosters[rosterTeam.value]||[]).forEach(p=>{
    const d=document.createElement("div");d.className="list-item";
    d.innerHTML=`<span>#${p.number} ${p.name} (${p.position})</span>`;
    const del=document.createElement("button");
    del.textContent="Delete";del.onclick=()=>{
      state.rosters[rosterTeam.value]=state.rosters[rosterTeam.value].filter(x=>x!==p);
      renderRoster();save();
    };
    d.appendChild(del);rosterList.appendChild(d);
  });
}

ngHome.onchange=()=>populateGoalies(ngHome.value,ngHomeG);
ngAway.onchange=()=>populateGoalies(ngAway.value,ngAwayG);
function populateGoalies(team,sel){
  sel.innerHTML='<option value="">Goalie</option>';
  (state.rosters[team]||[]).filter(p=>p.position==="G")
    .forEach(g=>sel.innerHTML+=`<option>${g.name}</option>`);
}

startGame.onclick=()=>{
  state.game={
    home:ngHome.value,away:ngAway.value,
    score:{home:0,away:0},
    shots:{home:0,away:0},
    faceoffs:{home:0,away:0},
    period:1,notes:"",
    goalieResults:{
      home:{win:false,loss:false,tie:false,shutout:false},
      away:{win:false,loss:false,tie:false,shutout:false}
    }
  };
  state.clock.seconds=1200;renderClock();
  gameStatus.textContent=`Period 1 — ${state.game.away} @ ${state.game.home}`;
  document.querySelector('[data-tab="game"]').click();
  setupGameSelectors();save();
};

clockToggle.onclick=()=>{
  state.clock.running=!state.clock.running;
  if(state.clock.running){
    state.clock.timer=setInterval(()=>{
      if(state.clock.seconds>0){state.clock.seconds--;renderClock();save();}
    },1000);
  } else clearInterval(state.clock.timer);
};

advancePeriod.onclick=()=>{
  state.game.period++;state.clock.seconds=1200;
  gameStatus.textContent=`Period ${state.game.period} — ${state.game.away} @ ${state.game.home}`;
  renderClock();save();
};

endGame.onclick=()=>{
  state.clock.running=false;
  clearInterval(state.clock.timer);
  gameStatus.textContent=`FINAL — ${state.game.away} @ ${state.game.home}`;
  save();
};

function renderClock(){
  clock.textContent=
    `${String(Math.floor(state.clock.seconds/60)).padStart(2,'0')}:${String(state.clock.seconds%60).padStart(2,'0')}`;
}

function setupGameSelectors(){
  goalTeam.innerHTML=shotTeam.innerHTML=penTeam.innerHTML=foTeam.innerHTML=
    '<option>Home</option><option>Away</option>';
  goalTeam.onchange=shotTeam.onchange=penTeam.onchange=populatePlayers;
  populatePlayers.call(goalTeam);
}

function populatePlayers(){
  const key=this.value==="Away"?"away":"home";
  const team=state.game[key];
  const list=state.rosters[team]||[];
  goalScorer.innerHTML=goalA1.innerHTML=goalA2.innerHTML=
  shotPlayer.innerHTML=penPlayer.innerHTML=
    `<option></option>`+list.map(p=>`<option>${p.name}</option>`).join("");
}

recordGoal.onclick=()=>{
  const k=goalTeam.value==="Away"?"away":"home";
  state.game.score[k]++;updateScore();
  eventLog.innerHTML+=`${clock.textContent} P${state.game.period} GOAL ${goalScorer.value}<br>`;
  save();
};

recordShot.onclick=()=>{
  const k=shotTeam.value==="Away"?"away":"home";
  state.game.shots[k]++;updateScore();
  eventLog.innerHTML+=`${clock.textContent} SHOT ${shotPlayer.value}<br>`;
  save();
};

recordFO.onclick=()=>{
  const k=foTeam.value==="Away"?"away":"home";
  state.game.faceoffs[k]++;updateScore();save();
};

recordPenalty.onclick=()=>{
  eventLog.innerHTML+=`${clock.textContent} PEN ${penPlayer.value} ${penType.value} ${penMinutes.value}m<br>`;
  save();
};

gameNotes.oninput=()=>{state.game.notes=gameNotes.value;save();};

function updateScore(){
  scoreHome.textContent=state.game.score.home;
  scoreAway.textContent=state.game.score.away;
  shotsHome.textContent=state.game.shots.home;
  shotsAway.textContent=state.game.shots.away;
  foHome.textContent=state.game.faceoffs.home;
  foAway.textContent=state.game.faceoffs.away;
}

function goalieRow(label,key){
  const g=state.game.goalieResults[key];
  return `
  <div class="box">
    <strong>${label} Goalie (Manual)</strong><br>
    <label><input type="checkbox" ${g.win?"checked":""} onchange="setG('${key}','win')"> W</label>
    <label><input type="checkbox" ${g.loss?"checked":""} onchange="setG('${key}','loss')"> L</label>
    <label><input type="checkbox" ${g.tie?"checked":""} onchange="setG('${key}','tie')"> T</label>
    <label><input type="checkbox" ${g.shutout?"checked":""} onchange="toggleSO('${key}')"> Shutout</label>
  </div>`;
}

window.setG=(k,f)=>{
  const g=state.game.goalieResults[k];
  g.win=g.loss=g.tie=false;g[f]=true;save();renderBoxScore();
};
window.toggleSO=k=>{state.game.goalieResults[k].shutout=!state.game.goalieResults[k].shutout;save();};

function renderBoxScore(){
  if(!state.game){boxScore.innerHTML="No game";return;}
  boxScore.innerHTML=`
    <strong>${state.game.away} @ ${state.game.home}</strong><br>
    Final: ${state.game.score.away} – ${state.game.score.home}<br><br>
    ${goalieRow("Away","away")}
    ${goalieRow("Home","home")}
    <strong>Notes</strong><br>${state.game.notes||"None"}
  `;
}

renderSeasons();renderTeams();renderRoster();
if(state.game){updateScore();renderClock();}
</script>
</body>
</html>