<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hockey Stat Sheet</title>

<style>
body { font-family: system-ui; margin: 0; }
nav { display: flex; background: #111; color: white; }
nav button { flex: 1; padding: 12px; border: none; background: none; color: white; }
nav button.active { background: #333; }
section { display: none; padding: 12px; }
section.active { display: block; }
input, select, button { margin: 4px 0; padding: 6px; }
.log { border-top: 1px solid #ccc; margin-top: 10px; padding-top: 10px; }
.scoreline { font-size: 18px; margin: 8px 0; }
table { width:100%; border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:4px; text-align:center; }
th { background:#eee; }
</style>
</head>

<body>

<nav>
  <button data-tab="seasons" class="active">Seasons</button>
  <button data-tab="teams">Teams</button>
  <button data-tab="newgame">New Game</button>
  <button data-tab="game">Game</button>
  <button data-tab="boxscore">Box Score</button>
</nav>

<section id="seasons" class="active">
  <h3>Seasons</h3>
  <input id="seasonName" placeholder="Season name">
  <button id="addSeason">Add Season</button>
  <div id="seasonList"></div>
</section>

<section id="teams">
  <h3>Teams</h3>
  <select id="teamSeason"></select><br>
  <input id="teamName" placeholder="Team name">
  <input id="teamAbbr" placeholder="Abbr">
  <button id="addTeam">Add Team</button>
  <div id="teamList"></div>

  <h4>Roster</h4>
  <select id="rosterTeam"></select><br>
  <input id="playerNum" placeholder="#" style="width:60px">
  <input id="playerName" placeholder="Player name">
  <select id="playerPos">
    <option value="F">Forward</option>
    <option value="D">Defense</option>
    <option value="G">Goalie</option>
  </select>
  <button id="addPlayer">Add Player</button>
  <div id="rosterList"></div>
</section>

<section id="newgame">
  <h3>New Game</h3>
  <select id="ngSeason"></select><br>
  <select id="ngAway"></select>
  <select id="ngAwayG"></select><br>
  <select id="ngHome"></select>
  <select id="ngHomeG"></select><br>
  <button id="startGame">Start Game</button>
</section>

<section id="game">
  <h3 id="gameStatus"></h3>

  <div class="scoreline">
    Score: <span id="scoreAway">0</span> – <span id="scoreHome">0</span><br>
    Shots: <span id="shotsAway">0</span> – <span id="shotsHome">0</span>
  </div>

  <h2 id="clock">20:00</h2>
  <button id="clockToggle">Start / Stop</button>
  <button id="clockPlus">-1 min</button>
  <button id="advancePeriod">Advance Period</button>
  <button id="endGame">End Game</button>

  <div class="log" id="eventLog"></div>
</section>

<section id="boxscore">
  <h3>Box Score</h3>
  <div id="boxScoreContent"></div>
</section>

<script>
const $ = id => document.getElementById(id);
const STORAGE_KEY = 'hockeyStatSheet';

/* ---------- STATE ---------- */
let state = {
  seasons: [],
  teams: {},
  rosters: {},
  game: null,
  clock: { seconds:1200, running:false, timer:null }
};

/* ---------- PERSISTENCE ---------- */
function saveState(){
  const clone = JSON.parse(JSON.stringify(state));
  clone.clock.running = false;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(clone));
}

function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;
  state = JSON.parse(raw);
}

/* ---------- TABS ---------- */
document.querySelectorAll('nav button').forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll('nav button').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    b.classList.add('active');
    $(b.dataset.tab).classList.add('active');
    if(b.dataset.tab==='boxscore')renderBoxScore();
  };
});

/* ---------- SEASONS ---------- */
addSeason.onclick=()=>{
  if(!seasonName.value)return;
  state.seasons.push(seasonName.value);
  seasonName.value='';
  renderSeasons();
  saveState();
};

function renderSeasons(){
  seasonList.innerHTML = state.seasons.join('<br>');
  ngSeason.innerHTML = teamSeason.innerHTML =
    state.seasons.map(s=>`<option>${s}</option>`).join('');
}

/* ---------- TEAMS ---------- */
addTeam.onclick=()=>{
  const s=teamSeason.value;
  if(!state.teams[s])state.teams[s]=[];
  state.teams[s].push({name:teamName.value,abbr:teamAbbr.value});
  state.rosters[teamName.value]=[];
  teamName.value=teamAbbr.value='';
  renderTeams();
  saveState();
};

function renderTeams(){
  teamList.innerHTML='';
  rosterTeam.innerHTML=ngHome.innerHTML=ngAway.innerHTML='';
  (state.teams[teamSeason.value]||[]).forEach(t=>{
    teamList.innerHTML+=`${t.name} (${t.abbr})<br>`;
    rosterTeam.innerHTML+=`<option>${t.name}</option>`;
    ngHome.innerHTML+=`<option>${t.name}</option>`;
    ngAway.innerHTML+=`<option>${t.name}</option>`;
  });
}

/* ---------- ROSTERS ---------- */
addPlayer.onclick=()=>{
  const t=rosterTeam.value;
  state.rosters[t].push({
    number:playerNum.value,
    name:playerName.value,
    position:playerPos.value,
    g:0,a:0,shots:0,pim:0
  });
  playerNum.value=playerName.value='';
  renderRoster(t);
  saveState();
};

function renderRoster(team){
  rosterList.innerHTML = (state.rosters[team]||[])
    .map(p=>`#${p.number} ${p.name} (${p.position})`).join('<br>');
}

/* ---------- GAME ---------- */
startGame.onclick=()=>{
  state.game={
    home:ngHome.value,
    away:ngAway.value,
    score:{home:0,away:0},
    shots:{home:0,away:0},
    period:1,
    ended:false
  };
  resetClock();
  updateScore();
  gameStatus.textContent=`Period 1 — ${state.game.away} @ ${state.game.home}`;
  document.querySelector('[data-tab="game"]').click();
  saveState();
};

/* ---------- CLOCK ---------- */
function resetClock(){state.clock.seconds=1200;renderClock();}
function renderClock(){
  clock.textContent=
    String(Math.floor(state.clock.seconds/60)).padStart(2,'0')+':' +
    String(state.clock.seconds%60).padStart(2,'0');
}

clockToggle.onclick=()=>{
  state.clock.running=!state.clock.running;
  if(state.clock.running){
    state.clock.timer=setInterval(()=>{
      if(state.clock.seconds>0){
        state.clock.seconds--;
        renderClock();
      }
    },1000);
  } else clearInterval(state.clock.timer);
};

clockPlus.onclick=()=>{
  state.clock.seconds=Math.max(0,state.clock.seconds-60);
  renderClock();
};

advancePeriod.onclick=()=>{
  state.game.period++;
  resetClock();
  gameStatus.textContent=`Period ${state.game.period}`;
  saveState();
};

endGame.onclick=()=>{
  state.game.ended=true;
  gameStatus.textContent='FINAL';
  saveState();
};

/* ---------- BOX SCORE ---------- */
function renderBoxScore(){
  if(!state.game)return;
  let html='';
  ['away','home'].forEach(side=>{
    const team=state.game[side];
    html+=`<h4>${team}</h4><table>
      <tr><th>#</th><th>Name</th><th>G</th><th>A</th><th>S</th><th>PIM</th></tr>`;
    (state.rosters[team]||[]).forEach(p=>{
      html+=`<tr>
        <td>${p.number}</td>
        <td>${p.name}</td>
        <td>${p.g}</td>
        <td>${p.a}</td>
        <td>${p.shots}</td>
        <td>${p.pim}</td>
      </tr>`;
    });
    html+='</table>';
  });
  boxScoreContent.innerHTML=html;
}

function updateScore(){
  scoreHome.textContent=state.game.score.home;
  scoreAway.textContent=state.game.score.away;
  shotsHome.textContent=state.game.shots.home;
  shotsAway.textContent=state.game.shots.away;
}

/* ---------- INIT ---------- */
loadState();
renderSeasons();
renderTeams();
if(state.rosters[rosterTeam.value])renderRoster(rosterTeam.value);
if(state.game)updateScore();
renderClock();
</script>
</body>
</html>